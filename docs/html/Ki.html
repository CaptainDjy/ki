<html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Hammerspoon docs: Ki</title>
    <style type="text/css">
      a { text-decoration: none; }
      a:hover { text-decoration: underline; }
      th { background-color: #DDDDDD; vertical-align: top; padding: 3px; }
      td { width: 100%; background-color: #EEEEEE; vertical-align: top; padding: 3px; }
      table { width: 100% ; border: 1px solid #0; text-align: left; }
      section > table table td { width: 0; }
    </style>
    <link rel="stylesheet" href="docs.css" type="text/css" media="screen" />
  </head>
  <body>
    <header>
      <h1><a href="./index.html">docs</a> &raquo; Ki</h1>
      <p><strong>Enable composable, modal commands to automate your Mac environment</strong></p>
<p>Here's a list of terms with definitions specific to this extension:</p>
<ul>
<li><p><strong><em>event</em></strong> - a keydown event. The event object structure matches the argument list for hotkeys bindings in Hammerspoon: modifier keys, key name, and event handler function. For example, the following table represents an keydown event on <code>⇧⌘m</code>:</p>

<pre><code>{ {"shift", "cmd"}, "m", handleEvent }</code></pre>
</li>
<li><p><strong><em>state event</em></strong> - a table that defines a unidirectional link between two states in the finite state machine. For example, the <code>enterEntityMode</code> state event allows the user to transition from <code>normal</code> mode to <code>entity</code> mode by calling <code>ki.state:entityEntityMode</code>:</p>

<pre><code>{ name = "enterEntityMode", from = "normal", to = "entity" }</code></pre>
</li>
<li><p><strong><em>transition event</em></strong> - a keydown event with a handler function that invokes a state change through the finite state machine. For example, the following transition events invoke fsm callbacks to allow the user to enter <code>entity</code> and <code>action</code> mode:</p>

<pre><code>{ {"cmd"}, ";", function() ki.state:enterEntityMode() end },
{ {"cmd"}, "'", function() ki.state:enterActionMode() end },</code></pre>
</li>
<li><p><strong><em>workflow</em></strong> - a list of transition and workflow events that execute a specific task, cycling from <code>normal</code> mode back to <code>normal</code> mode</p>
</li>
<li><p><strong><em>workflow event</em></strong> - a keydown event that's part of some workflow using the Hammerspoon API (i.e., event definitions in <code>default-workflows.lua</code>, or any event that is not a transition or state event)</p>
</li>
</ul>

      </header>
      <h3>API Overview</h3>
      <ul>
        <li>Variables - Configurable values</li>
          <ul>
            <li><a href="#history">history</a></li>
            <li><a href="#state">state</a></li>
            <li><a href="#states">states</a></li>
            <li><a href="#statusDisplay">statusDisplay</a></li>
            <li><a href="#transitions">transitions</a></li>
            <li><a href="#workflows">workflows</a></li>
          </ul>
        <li>Methods - API calls which can only be made on an object returned by a constructor</li>
          <ul>
            <li><a href="#createEntityEventHandler">createEntityEventHandler</a></li>
            <li><a href="#createEventsMetatable">createEventsMetatable</a></li>
            <li><a href="#start">start</a></li>
            <li><a href="#stop">stop</a></li>
            <li><a href="#triggerWorkflow">triggerWorkflow</a></li>
          </ul>
      </ul>
      <h3>API Documentation</h3>
        <h4 class="documentation-section">Variables</h4>
          <section id="history">
            <a name="//apple_ref/cpp/Variable/history" class="dashAnchor"></a>
            <h5><a href="#history">history</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki.history</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Variable</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>A table that stores the <code>action</code>, <code>commands</code>, and <code>workflow</code> history of all state transitions. The <code>action</code> and <code>workflow</code> fields are cleared out and the <code>commands</code> stores the series of events (which make up the workflow) when the Ki mode transitions back to the initial state.</p>
</td>
              </tr>
            </table>
          </section>
          <section id="state">
            <a name="//apple_ref/cpp/Variable/state" class="dashAnchor"></a>
            <h5><a href="#state">state</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki.state</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Variable</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>The finite state machine implementation used to interface with predefined state events in transition event handlers.</p>
</td>
              </tr>
            </table>
          </section>
          <section id="states">
            <a name="//apple_ref/cpp/Variable/states" class="dashAnchor"></a>
            <h5><a href="#states">states</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki.states</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Variable</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>A table containing the state events in the finite state machine.</p>
</td>
              </tr>
            </table>
          </section>
          <section id="statusDisplay">
            <a name="//apple_ref/cpp/Variable/statusDisplay" class="dashAnchor"></a>
            <h5><a href="#statusDisplay">statusDisplay</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki.statusDisplay</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Variable</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>A table that defines the behavior for displaying the status on mode transitions. The <code>show</code> function should clear out any previous display and show the current transitioned mode with an action if available.</p>
<ul>
<li><code>show</code> - A function invoked when a mode transition event occurs, with the following argument(s):<ul>
<li><code>status</code> - a string value containing the current mode of the finite state machine (i.e., "normal", "entity", etc.)</li>
<li><code>key</code> - an optional char value of the key that triggered the state (i.e., "n", "N", etc.)</li>
</ul>
</li>
</ul>
<p>Defaults to a simple text display in the center of the menu bar of the focused screen.</p>
</td>
              </tr>
            </table>
          </section>
          <section id="transitions">
            <a name="//apple_ref/cpp/Variable/transitions" class="dashAnchor"></a>
            <h5><a href="#transitions">transitions</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki.transitions</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Variable</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>A table containing the definitions of transition events. The following <code>normal</code> mode transition events are defined to enable the following transitions by default:</p>
<ul>
<li><code>⌘;</code> to enter <code>entity</code> mode</li>
<li><code>⌘'</code> to enter <code>action</code> mode</li>
<li><code>⌘⇧;</code> to enter <code>url</code> mode</li>
<li><code>⌘⇧'</code> to enter <code>select</code> mode</li>
</ul>
<p>Note: <em><code>action</code> mode is special in that its transition events are generated at runtime, since hotkeys in <code>action</code> mode should be automatically dispatched to the intended <code>entity</code> handler. This is why there are no explicit transition events to <code>entity</code> mode defined in this default table (otherwise it would require manually defining every <code>action</code> event to transition to <code>entity</code> mode).</em></p>
</td>
              </tr>
            </table>
          </section>
          <section id="workflows">
            <a name="//apple_ref/cpp/Variable/workflows" class="dashAnchor"></a>
            <h5><a href="#workflows">workflows</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki.workflows</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Variable</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>A table containing lists of workflow events keyed by mode name. The following example creates two entity and url events:</p>

<pre><code>    local function handleUrlEvent(url)
        hs.urlevent.openURL(url)
        spoon.Ki.state:exitMode()
    end
    local function handleApplicationEvent(appName)
        hs.application.launchOrFocus(appName)
        spoon.Ki.state:exitMode()
    end

    spoon.Ki.workflows = {
        url = {
            { nil, "g", function() handleUrlEvent("https://google.com") end },
            { nil, "r", function() handleUrlEvent("https://reddit.com") end },
        },
        entity = {
            { nil, "s", function() handleApplicationEvent("Safari") end) },
            { {"shift"}, "s", function() handleApplicationEvent("Spotify") end) },
        },
    }</code></pre>
</td>
              </tr>
            </table>
          </section>
        <h4 class="documentation-section">Methods</h4>
          <section id="createEntityEventHandler">
            <a name="//apple_ref/cpp/Method/createEntityEventHandler" class="dashAnchor"></a>
            <h5><a href="#createEntityEventHandler">createEntityEventHandler</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki:createEntityEventHandler(applicationName, eventHandler)</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Method</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>A helper function that invokes an event handler callback with the <code>hs.application</code> and keydown event information so event handlers are somewhat less boilerplate-y</p>
<p>Parameters:</p>
<ul>
<li><code>applicationName</code> - The application name for use in finding the <code>hs.application</code></li>
<li><code>eventHandler</code> - A callback function that handles the entity event with the following arguments:<ul>
<li><code>app</code> - The <code>hs.application</code> object of the provided application name</li>
<li><code>keyName</code> - A string containing the name of a keyboard key (in <code>hs.keycodes.map</code>)</li>
<li><code>flags</code> - A table containing the keyboard modifiers in the keyboard event (from <code>hs.eventtap.event:getFlags()</code>)</li>
</ul>
</li>
</ul>
</td>
              </tr>
            </table>
          </section>
          <section id="createEventsMetatable">
            <a name="//apple_ref/cpp/Method/createEventsMetatable" class="dashAnchor"></a>
            <h5><a href="#createEventsMetatable">createEventsMetatable</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki:createEventsMetatable(overrideLHS)</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Method</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>A function that creates a metatable defined with operations specific to Ki events. The metatable comes with the following operations:</p>
<ul>
<li><code>__add</code> - Allow events to be added together, with errors on conflicting hotkeys if the override is disabled. In the case of a merge, the event in the first addend (the left item in the operation) will be overwritten with the second addend.<ul>
<li>For example, this metatable is set for <code>ki.transitions</code> with the functionality of overriding events disabled, since we wouldn't want to accidentally override any of the transition event hotkeys.</li>
</ul>
</li>
</ul>
<p>Parameters:</p>
<ul>
<li><code>overrideLHS</code> - an optional boolean value to indicate whether to override events in an add operation</li>
</ul>
</td>
              </tr>
            </table>
          </section>
          <section id="start">
            <a name="//apple_ref/cpp/Method/start" class="dashAnchor"></a>
            <h5><a href="#start">start</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki:start()</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Method</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>Sets the status display, initializes transition and workflow events, and starts the keyboard event listener</p>
<p>Parameters:</p>
<ul>
<li>None</li>
</ul>
<p>Returns:</p>
<ul>
<li>The <code>hs.eventtap</code> object</li>
</ul>
</td>
              </tr>
            </table>
          </section>
          <section id="stop">
            <a name="//apple_ref/cpp/Method/stop" class="dashAnchor"></a>
            <h5><a href="#stop">stop</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki:stop()</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Method</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>Stops the keyboard event listener</p>
<p>Parameters:</p>
<ul>
<li>None</li>
</ul>
<p>Returns:</p>
<ul>
<li>The <code>hs.eventtap</code> object</li>
</ul>
</td>
              </tr>
            </table>
          </section>
          <section id="triggerWorkflow">
            <a name="//apple_ref/cpp/Method/triggerWorkflow" class="dashAnchor"></a>
            <h5><a href="#triggerWorkflow">triggerWorkflow</a></h5>
            <table>
              <tr>
                <th>Signature</th>
                <td><code>Ki:triggerWorkflow(event)</code></td>
              </tr>
              <tr>
                <th>Type</th>
                <td>Method</td>
              </tr>
              <tr>
                <th>Description</th>
                <td><p>A function that triggers a workflow (a series of events)</p>
<p>Parameters:</p>
<ul>
<li><code>event</code> - A list of items describing an event with the following order:<ul>
<li><code>app</code> - The <code>hs.application</code> object of the provided application name</li>
<li><code>keyName</code> - A string containing the name of a keyboard key (in <code>hs.keycodes.map</code>)</li>
<li><code>flags</code> - A table containing the keyboard modifiers in the keyboard event (from <code>hs.eventtap.event:getFlags()</code>)</li>
</ul>
</li>
</ul>
</td>
              </tr>
            </table>
          </section>
  </body>
</html>